<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>欢迎页面</title>
  <style>
    :root {
      --tw-bg-opacity: 1;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body, html {
      height: 100%;
      overflow: hidden;
      font-family: Arial, sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      background-color: rgba(0, 0, 0, 0);
    }

    #main-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      height: 100%;
      width: 100%;
      padding: 5px;
      overflow-y: auto;
      scroll-behavior: smooth;
      box-sizing: border-box;
    }

    .welcome-header {
      font-size: 5vw;
      font-weight: bold;
      color: #ff4c4c;
      margin-bottom: 10px;
      display: flex;
      justify-content: center;
      align-items: center;
      text-align: center;
    }

    .intro {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      justify-content: center;
      width: 100%;
      text-align: center;
      flex-direction: row;
    }

    .intro .item {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      margin: 5px 10px;
      font-size: 4.5vw;
      flex-wrap: nowrap;
      min-width: 200px;
    }

    .intro.icon {
      margin-right: 8px;
      font-size: 4vw;
    }

    .intro.highlight {
      color: #007bff;
      font-weight: bold;
    }

    .intro a {
      color: #007bff;
      text-decoration: none;
    }

    .intro a:hover {
      text-decoration: underline;
    }

    .welcome-message {
      background-color: #e7f3ff;
      border: 1px solid #b0d4f1;
      padding: 15px;
      border-radius: 8px;
      margin-top: 20px;
      width: 100%;
      box-sizing: border-box;
      font-size: 3.8vw;
    }

    .welcome-message p {
      margin: 8px 0;
      line-height: 1.5;
    }

    .ip-address {
      filter: blur(5px);
      transition: filter 0.3s ease;
    }

    .ip-address:hover {
      filter: blur(0);
    }

    .loading-spinner {
      width: 8vw;
      height: 8vw;
      border: 4px solid rgba(0, 0, 0, 0.1);
      border-radius: 50%;
      border-top: 4px solid #4CAF50;
      animation: spin 1s linear infinite;
      margin-bottom: 10px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .error-message {
      color: #ff6565;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
    }

    .error-icon {
      font-size: 6vw;
      margin-bottom: 10px;
    }

    #error-message {
      font-size: 4vw;
      margin-bottom: 15px;
    }

    #retry-button {
      padding: 10px 20px;
      background-color: #4CAF50;
      color: white;
      border: none;
      border-radius: 5px;
      font-size: 3vw;
      cursor: pointer;
    }

    #retry-button:hover {
      background-color: #388E3C;
    }

    .github-link {
      font-size: 4vw;
      color: #333;
      text-decoration: none;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-top: 20px;
    }

    .github-link img {
      width: 5vw;
      height: 5vw;
      margin-right: 5px;
    }

    .github-link:hover {
      color: #000;
    }

    @media (max-width: 400px) {
      #welcome-info {
        font-size: 4.5vw;
        padding: 8px;
      }
      .welcome-header {
        font-size: 5.5vw;
      }
      .intro.item {
        font-size: 6vw;
      }
      .welcome-message {
        font-size: 6vw;
      }
    }
  </style>
</head>
<body>
  <div id="main-container">
    <div id="welcome-info">
      <div class="welcome-header">
        <h1>📢</h1> 欢迎来访者！
      </div>
      <div class="intro">
        <div class="item"><h1 class="icon">👋</h1>Hi，我是<span class="highlight" id="blogger-name"></span>，欢迎你！</div>
        <div class="item"><h1 class="icon">❓</h1>如有问题欢迎评论区交流！</div>
        <div class="item"><h1 class="icon">😡</h1>页面异常？尝试<strong>Ctrl + F5</strong></div>
        <div class="item"><h1 class="icon">📩</h1>如需联系我：<a href="#" id="contact-email">发送邮件</a> 🚀</div>
      </div>

      <div class="loading-spinner" id="loading-spinner"></div>

      <div class="welcome-message">
        <p>欢迎来自 <b id="visitor-location"></b> 的小友💖</p>
        <p>你当前距博主约 <b id="visitor-distance"></b> 公里！</p>
        <p>你的IP地址：<b class="ip-address" id="visitor-ip"></b></p>
        <p id="greeting-message"></p>
        <p>Tip：<b id="tip-message"></b></p>
      </div>
    </div>

    <a href="https://github.com/BDTA-zky/GeoWelcome" target="_blank" class="github-link" id="github-link">
      <img src="https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png" alt="GitHub Logo">
      GitHub
    </a>
  </div>

  <script>
    const CONFIG = {
      BLOGGER_NAME: 'BUZZ',
      EMAIL: 'mailto:2793217027@qq.com',
      GITHUB_URL: 'https://github.com/BDTA-zky/GeoWelcome',
      API_KEY: '填写您的API', 
      BLOG_LOCATION: { lng: 120.122587, lat: 30.350888 },
      CACHE_DURATION: 1000 * 60 * 60,
      HOME_PAGE_ONLY: true,
    };

    document.getElementById('blogger-name').textContent = CONFIG.BLOGGER_NAME;
    document.getElementById('contact-email').href = CONFIG.EMAIL;
    document.getElementById('github-link').href = CONFIG.GITHUB_URL;

    const fetchIpData = async () => {
      try {
        const response = await fetch(`https://api.nsmao.net/api/ipip/query?key=${encodeURIComponent(CONFIG.API_KEY)}`);
        if (!response.ok) {
          console.error('Response Error:', response.status, response.statusText);
          throw new Error(`网络响应不正常: ${response.status} ${response.statusText}`);
        }
        return await response.json();
      } catch (error) {
        console.error('Fetch IP Data Error:', error);
        throw new Error('无法获取IP信息，请检查网络连接或API配置');
      }
    };

    const showWelcome = ({ data, ip }) => {
      document.getElementById('loading-spinner').style.display = 'none';

      if (!data) return showErrorMessage();

      const { lng, lat, country, province, city, isp } = data;
      const dist = calculateDistance(lng, lat);
      const ipDisplay = formatIpDisplay(ip);
      const pos = formatLocation(country, province, city);

      document.getElementById('visitor-location').textContent = pos;
      document.getElementById('visitor-distance').textContent = dist;
      document.getElementById('visitor-ip').textContent = ipDisplay;
      document.getElementById('greeting-message').textContent = getTimeGreeting();
      document.getElementById('tip-message').textContent = getGreeting(country, province, city);
    };

    const formatLocation = (country, province, city) => {
      if (country && country === "中国") {
        return `${province} ${city}`;
      } else {
        return country || '神秘地区';
      }
    };

    const calculateDistance = (lng, lat) => {
      const R = 6371;
      const rad = Math.PI / 180;
      const dLat = (lat - CONFIG.BLOG_LOCATION.lat) * rad;
      const dLon = (lng - CONFIG.BLOG_LOCATION.lng) * rad;
      const a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +
          Math.cos(CONFIG.BLOG_LOCATION.lat * rad) * Math.cos(lat * rad) *
          Math.sin(dLon / 2) * Math.sin(dLon / 2);
      return Math.round(R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a)));
    };

    const formatIpDisplay = (ip) => ip.includes(":") ? "复杂的IPv6地址" : ip;

    const showErrorMessage = (message = '抱歉，无法获取信息') => {
      document.getElementById('loading-spinner').style.display = 'none';
      document.querySelector('.welcome-message').innerHTML = `
        <div class="error-message">
          <div class="error-icon">😕</div>
          <p id="error-message">${message}</p>
          <button id="retry-button">重试</button>
        </div>
      `;
      document.getElementById('retry-button').addEventListener('click', () => {
        document.getElementById('loading-spinner').style.display = 'block';
        fetchIpInfo();
      });
    };


        const getTimeGreeting = () => {
      const hour = new Date().getHours();
      if (hour < 11) return "早上好🌤️ ，一日之计在于晨";
      if (hour < 13) return "中午好☀️ ，记得午休喔~";
      if (hour < 17) return "下午好🕞 ，饮茶先啦！";
      if (hour < 19) return "即将下班🚶‍♂️，记得按时吃饭~";
      return "晚上好🌙 ，夜生活嗨起来！";
    };

    const greetings = {
      "中国": {
        "北京": "北——京——欢迎你~~~",
        "天津": "讲段相声吧",
        "河北": "山势巍巍成壁垒，天下雄关铁马金戈由此向，无限江山",
        "山西": "展开坐具长三尺，已占山河五百余",
        "内蒙古": "天苍苍，野茫茫，风吹草低见牛羊",
        "辽宁": "我想吃烤鸡架！",
        "吉林": "状元阁就是东北烧烤之王",
        "黑龙江": "很喜欢哈尔滨大剧院",
        "上海": "众所周知，中国只有两个城市",
        "江苏": {
          "南京": "这是我挺想去的城市啦",
          "苏州": "上有天堂，下有苏杭",
          "其他": "散装是必须要散装的"
        },
        "浙江": {
          "杭州": "东风渐绿西湖柳，雁已还人未南归",
          "其他": "望海楼明照曙霞,护江堤白蹋晴沙"
        },
        "河南": {
          "郑州": "豫州之域，天地之中",
          "信阳": "品信阳毛尖，悟人间芳华",
          "南阳": "臣本布衣，躬耕于南阳此南阳非彼南阳！",
          "驻马店": "嵖岈山的花很美哦！",
          "开封": "刚正不阿包青天",
          "洛阳": "洛阳牡丹甲天下",
          "其他": "可否带我品尝河南烩面啦？"
        },
        "安徽": "蚌埠住了，芜湖起飞",
        "福建": "井邑白云间，岩城远带山",
        "江西": "落霞与孤鹜齐飞，秋水共长天一色",
        "山东": "遥望齐州九点烟，一泓海水杯中泻",
        "湖北": {
          "黄冈": "红安将军县！辈出将才！",
          "其他": "来碗热干面~"
        },
        "湖南": "74751，长沙斯塔克",
        "广东": {
          "广州": "看小蛮腰，喝早茶了嘛~",
          "深圳": "今天你逛商场了嘛~",
          "阳江": "阳春合水！博主家乡~ 欢迎来玩~",
          "其他": "来两斤福建人~"
        },
        "广西": "桂林山水甲天下",
        "海南": "朝观日出逐白浪，夕看云起收霞光",
        "四川": "康康川妹子",
        "贵州": "茅台，学生，再塞200",
        "云南": "玉龙飞舞云缠绕，万仞冰川直耸天",
        "西藏": "躺在茫茫草原上，仰望蓝天",
        "陕西": "来份臊子面加馍",
        "甘肃": "羌笛何须怨杨柳，春风不度玉门关",
        "青海": "牛肉干和老酸奶都好好吃",
        "宁夏": "大漠孤烟直，长河落日圆",
        "新疆": "驼铃古道丝绸路，胡马犹闻唐汉风",
        "台湾": "我在这头，大陆在那头",
        "香港": "永定贼有残留地鬼嚎，迎击光非岁玉",
        "澳门": "性感荷官，在线发牌",
        "其他": "带我去你的城市逛逛吧！"
      },
      "美国": "Let us live in peace!",
      "日本": "よろしく、一緒に桜を見ませんか",
      "俄罗斯": "干了这瓶伏特加！",
      "法国": "C'est La Vie",
      "德国": "Die Zeit verging im Fluge.",
      "澳大利亚": "一起去大堡礁吧！",
      "加拿大": "拾起一片枫叶赠予你",
      "其他": "带我去你的国家逛逛吧"
    };

    const getGreeting = (country, province, city) => {
      const countryGreeting = greetings[country] || greetings["其他"];
      if (typeof countryGreeting === 'string') return countryGreeting;

      const provinceGreeting = countryGreeting[province];
      if (provinceGreeting) {
        if (typeof provinceGreeting === 'string') return provinceGreeting;

        const cityGreeting = provinceGreeting[city];
        if (cityGreeting) return cityGreeting;

        return provinceGreeting["其他"] || countryGreeting["其他"];
      }

      return countryGreeting["其他"];
    };

    const fetchIpInfo = async () => {
      try {
        const data = await fetchIpData();
        showWelcome(data);
      } catch (error) {
        showErrorMessage(error.message);
      }
    };

    document.addEventListener('DOMContentLoaded', fetchIpInfo);
  </script>
</body>
</html>

