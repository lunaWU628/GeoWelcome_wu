<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¬¢è¿é¡µé¢</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        body, html {
            height: 100%;
            overflow: hidden;
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        #main-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start; /* ä»é¡¶éƒ¨å¼€å§‹å¯¹é½ */
            height: 100%;
            width: 100%;
            padding: 20px;
            overflow-y: auto;
            scroll-behavior: smooth;
        }
        #welcome-info {
            user-select: none;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            width: 90vw;
            max-width: 400px;
            padding: 20px;
            border-radius: 12px;
            background-color: #ffffff;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            outline: 1px solid #dcdcdc;
            text-align: center;
            margin-bottom: 10px;
        }
        .welcome-header {
            font-size: 1.4rem;
            font-weight: bold;
            color: #ff4c4c;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
        }
        .intro {
            font-size: 1rem;
            margin-bottom: 15px;
            text-align: left;
            line-height: 1.8;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }
        .intro .item {
            display: flex;
            align-items: center;
            margin-bottom: 6px;
        }
        .intro .icon {
            margin-right: 8px;
            font-size: 1.2rem;
        }
        .intro .highlight {
            color: #007bff;
            font-weight: bold;
        }
        .intro a {
            color: #007bff;
            text-decoration: none;
        }
        .intro a:hover {
            text-decoration: underline;
        }
        .welcome-message {
            background-color: #e7f3ff;
            border: 1px solid #b0d4f1;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            width: 100%;
            box-sizing: border-box;
        }
        .welcome-message p {
            margin: 8px 0;
            line-height: 1.5;
        }
        .ip-address {
            filter: blur(5px);
            transition: filter 0.3s ease;
        }
        .ip-address:hover {
            filter: blur(0);
        }
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-radius: 50%;
            border-top: 4px solid #4CAF50;
            animation: spin 1s linear infinite;
            margin-bottom: 10px;
        }
        /* é”™è¯¯ä¿¡æ¯æ ·å¼ */
.error-message {
    color: #ff6565;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
}

.error-icon {
    font-size: 6vw; /* è®¾ç½®ä¸ºè§†å£å•ä½å¤§å° */
    margin-bottom: 10px;
}

#error-message {
    font-size: 4vw; /* é”™è¯¯ä¿¡æ¯å­—ä½“ */
    margin-bottom: 15px;
}

#retry-button {
    padding: 10px 20px;
    background-color: #4CAF50;
    color: white;
    border: none;
    border-radius: 5px;
    font-size: 3vw;
    cursor: pointer;
}

#retry-button:hover {
    background-color: #388E3C;
}

        .github-link {
            font-size: 1.2rem;
            color: #333;
            text-decoration: none;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-top: 20px;
        }
        .github-link img {
            width: 20px;
            height: 20px;
            margin-right: 5px;
        }
        .github-link:hover {
            color: #000;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div id="main-container">
        <div id="welcome-info">
            <div class="welcome-header">
                <span>ğŸ“¢</span> æ¬¢è¿æ¥è®¿è€…ï¼
            </div>
            <div class="intro">
                <div class="item"><span class="icon">ğŸ‘‹</span>Hiï¼Œæˆ‘æ˜¯ <span class="highlight" id="blogger-name"></span>ï¼Œæ¬¢è¿ä½ ï¼</div>
                <div class="item"><span class="icon">â“</span>å¦‚æœ‰é—®é¢˜æ¬¢è¿è¯„è®ºåŒºäº¤æµï¼</div>
                <div class="item"><span class="icon">ğŸ˜¡</span>é¡µé¢å¼‚å¸¸ï¼Ÿå°è¯• <strong>Ctrl + F5</strong></div>
                <div class="item"><span class="icon">ğŸ“©</span>å¦‚éœ€è”ç³»æˆ‘ï¼š<a href="#" id="contact-email">å‘é€é‚®ä»¶</a> ğŸš€</div>
            </div>
            <div class="loading-spinner" id="loading-spinner"></div>

            <!-- æ¬¢è¿ä¿¡æ¯å— -->
            <div class="welcome-message">
                <p>æ¬¢è¿æ¥è‡ª <b id="visitor-location"></b> çš„å°å‹ğŸ’–</p>
                <p>ä½ å½“å‰è·åšä¸»çº¦ <b id="visitor-distance"></b> å…¬é‡Œï¼</p>
                <p>ä½ çš„IPåœ°å€ï¼š<b class="ip-address" id="visitor-ip"></b></p>
                <p id="greeting-message"></p>
                <p>Tipï¼š<b id="tip-message"></b></p>
            </div>
        </div>

        <!-- GitHub é“¾æ¥ï¼Œå±…ä¸­æ”¾ç½®åœ¨å†…å®¹ä¸‹æ–¹ -->
        <a href="https://github.com/BDTA-zky" target="_blank" class="github-link" id="github-link">
            <img src="https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png" alt="GitHub Logo">
            GitHub
        </a>
    </div>

    <script>
        // é…ç½®å‚æ•°
        const CONFIG = {
            BLOGGER_NAME: 'BUZZ', // åšä¸»åå­—
            EMAIL: 'mailto:2793217027@qq.com', // åšä¸»çš„è”ç³»é‚®ç®±é“¾æ¥
            GITHUB_URL: 'https://github.com/BDTA-zky', // åšä¸»çš„ GitHub é“¾æ¥
            API_KEY: '4xR95RXijydgvLwXDmINz8ebaq', // API å¯†é’¥ï¼Œè¯·æ±‚ IP ä¿¡æ¯ç”¨
            BLOG_LOCATION: { lng: 113.506990, lat: 34.704587 }, // åšä¸»çš„ä½ç½®ç»çº¬åº¦
            CACHE_DURATION: 1000 * 60 * 60, // ç¼“å­˜æ—¶é—´ï¼ˆé»˜è®¤1å°æ—¶ï¼‰
            HOME_PAGE_ONLY: true, // æ˜¯å¦åªåœ¨é¦–é¡µæ˜¾ç¤º
        };

        // è®¾ç½®åšä¸»ä¿¡æ¯
        document.getElementById('blogger-name').textContent = CONFIG.BLOGGER_NAME;
        document.getElementById('contact-email').href = CONFIG.EMAIL;
        document.getElementById('github-link').href = CONFIG.GITHUB_URL;

        const fetchIpData = async () => {
            try {
                const response = await fetch(`https://api.76.al/api/ip/query?key=${encodeURIComponent(CONFIG.API_KEY)}`);
                if (!response.ok) {
                    console.error('Response Error:', response.status, response.statusText);
                    throw new Error(`ç½‘ç»œå“åº”ä¸æ­£å¸¸: ${response.status} ${response.statusText}`);
                }
                return await response.json();
            } catch (error) {
                console.error('Fetch IP Data Error:', error);
                throw new Error('æ— æ³•è·å–IPä¿¡æ¯ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–APIé…ç½®');
            }
        };

        const showWelcome = ({ data, ip }) => {
            document.getElementById('loading-spinner').style.display = 'none';

            if (!data) return showErrorMessage();

            const { lng, lat, country, prov, city } = data;
            const dist = calculateDistance(lng, lat);
            const ipDisplay = formatIpDisplay(ip);
            const pos = formatLocation(country, prov, city);

            document.getElementById('visitor-location').textContent = pos;
            document.getElementById('visitor-distance').textContent = dist;
            document.getElementById('visitor-ip').textContent = ipDisplay;
            document.getElementById('greeting-message').textContent = getTimeGreeting();
            document.getElementById('tip-message').textContent = getGreeting(country, prov, city);
        };

        const calculateDistance = (lng, lat) => {
            const R = 6371;
            const rad = Math.PI / 180;
            const dLat = (lat - CONFIG.BLOG_LOCATION.lat) * rad;
            const dLon = (lng - CONFIG.BLOG_LOCATION.lng) * rad;
            const a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +
                Math.cos(CONFIG.BLOG_LOCATION.lat * rad) * Math.cos(lat * rad) *
                Math.sin(dLon / 2) * Math.sin(dLon / 2);
            return Math.round(R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a)));
        };

        const formatIpDisplay = (ip) => ip.includes(":") ? "å¤æ‚çš„IPv6åœ°å€" : ip;
        const formatLocation = (country, prov, city) => country ? (country === "ä¸­å›½" ? `${prov} ${city}` : country) : 'ç¥ç§˜åœ°åŒº';

        const showErrorMessage = (message = 'æŠ±æ­‰ï¼Œæ— æ³•è·å–ä¿¡æ¯') => {
            document.getElementById('loading-spinner').style.display = 'none';
            document.querySelector('.welcome-message').innerHTML = `
                <div class="error-message">
                    <div class="error-icon">ğŸ˜•</div>
                    <p id="error-message">${message}</p>
                    <button id="retry-button">é‡è¯•</button>
                </div>
            `;

            // ç»™é‡è¯•æŒ‰é’®ç»‘å®šç‚¹å‡»äº‹ä»¶
            document.getElementById('retry-button').addEventListener('click', () => {
                document.getElementById('loading-spinner').style.display = 'block';
                fetchIpInfo(); // é‡æ–°å‘èµ·è¯·æ±‚
            });
        };


        const getTimeGreeting = () => {
            const hour = new Date().getHours();
            if (hour < 11) return "æ—©ä¸Šå¥½ğŸŒ¤ï¸ ï¼Œä¸€æ—¥ä¹‹è®¡åœ¨äºæ™¨";
            if (hour < 13) return "ä¸­åˆå¥½â˜€ï¸ ï¼Œè®°å¾—åˆä¼‘å–”~";
            if (hour < 17) return "ä¸‹åˆå¥½ğŸ• ï¼Œé¥®èŒ¶å…ˆå•¦ï¼";
            if (hour < 19) return "å³å°†ä¸‹ç­ğŸš¶â€â™‚ï¸ï¼Œè®°å¾—æŒ‰æ—¶åƒé¥­~";
            return "æ™šä¸Šå¥½ğŸŒ™ ï¼Œå¤œç”Ÿæ´»å—¨èµ·æ¥ï¼";
        };

        const greetings = {
            "ä¸­å›½": {
                "æ²³å—çœ": { "éƒ‘å·å¸‚": "è±«å·ä¹‹åŸŸï¼Œå¤©åœ°ä¹‹ä¸­", "å…¶ä»–": "æ²³å—æ¬¢è¿ä½ ï¼" },
                "å…¶ä»–": "ä¸­å›½æ¬¢è¿ä½ ï¼"
            },
            "ç¾å›½": "Let us live in peace!",
            "å…¶ä»–": "å¸¦æˆ‘å»ä½ çš„å›½å®¶é€›é€›å§"
        };

        const getGreeting = (country, province, city) => {
            const countryGreeting = greetings[country] || greetings["å…¶ä»–"];
            if (typeof countryGreeting === 'string') return countryGreeting;
            const provinceGreeting = countryGreeting[province] || countryGreeting["å…¶ä»–"];
            return provinceGreeting[city] || provinceGreeting["å…¶ä»–"] || countryGreeting["å…¶ä»–"];
        };

        const fetchIpInfo = async () => {
            try {
                const data = await fetchIpData();
                showWelcome(data);
            } catch (error) {
                showErrorMessage(error.message);
            }
        };

        document.addEventListener('DOMContentLoaded', fetchIpInfo);
    </script>
</body>
</html>
