<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ¬¢è¿é¡µé¢</title>
  <style>
    :root {
      --tw-bg-opacity: 1;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body, html {
      height: 100%;
      overflow: hidden;
      font-family: Arial, sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      background-color: rgba(0, 0, 0, 0);
    }

    #main-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      height: 100%;
      width: 100%;
      padding: 5px;
      overflow-y: auto;
      scroll-behavior: smooth;
      box-sizing: border-box;
    }

    .welcome-header {
      font-size: 5vw;
      font-weight: bold;
      color: #ff4c4c;
      margin-bottom: 10px;
      display: flex;
      justify-content: center;
      align-items: center;
      text-align: center;
    }

    .intro {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      justify-content: center;
      width: 100%;
      text-align: center;
      flex-direction: row;
    }

    .intro .item {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      margin: 5px 10px;
      font-size: 4.5vw;
      flex-wrap: nowrap;
      min-width: 200px;
    }

    .intro.icon {
      margin-right: 8px;
      font-size: 4vw;
    }

    .intro.highlight {
      color: #007bff;
      font-weight: bold;
    }

    .intro a {
      color: #007bff;
      text-decoration: none;
    }

    .intro a:hover {
      text-decoration: underline;
    }

    .welcome-message {
      background-color: #e7f3ff;
      border: 1px solid #b0d4f1;
      padding: 15px;
      border-radius: 8px;
      margin-top: 20px;
      width: 100%;
      box-sizing: border-box;
      font-size: 3.8vw;
    }

    .welcome-message p {
      margin: 8px 0;
      line-height: 1.5;
    }

    .ip-address {
      filter: blur(5px);
      transition: filter 0.3s ease;
    }

    .ip-address:hover {
      filter: blur(0);
    }

    .loading-spinner {
      width: 8vw;
      height: 8vw;
      border: 4px solid rgba(0, 0, 0, 0.1);
      border-radius: 50%;
      border-top: 4px solid #4CAF50;
      animation: spin 1s linear infinite;
      margin-bottom: 10px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .error-message {
      color: #ff6565;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
    }

    .error-icon {
      font-size: 6vw;
      margin-bottom: 10px;
    }

    #error-message {
      font-size: 4vw;
      margin-bottom: 15px;
    }

    #retry-button {
      padding: 10px 20px;
      background-color: #4CAF50;
      color: white;
      border: none;
      border-radius: 5px;
      font-size: 3vw;
      cursor: pointer;
    }

    #retry-button:hover {
      background-color: #388E3C;
    }

    .github-link {
      font-size: 4vw;
      color: #333;
      text-decoration: none;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-top: 20px;
    }

    .github-link img {
      width: 5vw;
      height: 5vw;
      margin-right: 5px;
    }

    .github-link:hover {
      color: #000;
    }

    @media (max-width: 400px) {
      #welcome-info {
        font-size: 4.5vw;
        padding: 8px;
      }
      .welcome-header {
        font-size: 5.5vw;
      }
      .intro.item {
        font-size: 6vw;
      }
      .welcome-message {
        font-size: 6vw;
      }
    }
  </style>
</head>
<body>
  <div id="main-container">
    <div id="welcome-info">
      <div class="welcome-header">
        <h1>ğŸ“¢</h1> æ¬¢è¿æ¥è®¿è€…ï¼
      </div>
      <div class="intro">
        <div class="item"><h1 class="icon">ğŸ‘‹</h1>Hiï¼Œæˆ‘æ˜¯<span class="highlight" id="blogger-name"></span>ï¼Œæ¬¢è¿ä½ ï¼</div>
        <div class="item"><h1 class="icon">â“</h1>å¦‚æœ‰é—®é¢˜æ¬¢è¿è¯„è®ºåŒºäº¤æµï¼</div>
        <div class="item"><h1 class="icon">ğŸ˜¡</h1>é¡µé¢å¼‚å¸¸ï¼Ÿå°è¯•<strong>Ctrl + F5</strong></div>
        <div class="item"><h1 class="icon">ğŸ“©</h1>å¦‚éœ€è”ç³»æˆ‘ï¼š<a href="#" id="contact-email">å‘é€é‚®ä»¶</a> ğŸš€</div>
      </div>

      <div class="loading-spinner" id="loading-spinner"></div>

      <div class="welcome-message">
        <p>æ¬¢è¿æ¥è‡ª <b id="visitor-location"></b> çš„å°å‹ğŸ’–</p>
        <p>ä½ å½“å‰è·åšä¸»çº¦ <b id="visitor-distance"></b> å…¬é‡Œï¼</p>
        <p>ä½ çš„IPåœ°å€ï¼š<b class="ip-address" id="visitor-ip"></b></p>
        <p id="greeting-message"></p>
        <p>Tipï¼š<b id="tip-message"></b></p>
      </div>
    </div>

    <a href="https://github.com/BDTA-zky/GeoWelcome" target="_blank" class="github-link" id="github-link">
      <img src="https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png" alt="GitHub Logo">
      GitHub
    </a>
  </div>

  <script>
    const CONFIG = {
      BLOGGER_NAME: 'BUZZ',
      EMAIL: 'mailto:2793217027@qq.com',
      GITHUB_URL: 'https://github.com/BDTA-zky/GeoWelcome',
      API_KEY: 'å¡«å†™æ‚¨çš„API', 
      BLOG_LOCATION: { lng: 120.122587, lat: 30.350888 },
      CACHE_DURATION: 1000 * 60 * 60,
      HOME_PAGE_ONLY: true,
    };

    document.getElementById('blogger-name').textContent = CONFIG.BLOGGER_NAME;
    document.getElementById('contact-email').href = CONFIG.EMAIL;
    document.getElementById('github-link').href = CONFIG.GITHUB_URL;

    const fetchIpData = async () => {
      try {
        const response = await fetch(`https://api.nsmao.net/api/ipip/query?key=${encodeURIComponent(CONFIG.API_KEY)}`);
        if (!response.ok) {
          console.error('Response Error:', response.status, response.statusText);
          throw new Error(`ç½‘ç»œå“åº”ä¸æ­£å¸¸: ${response.status} ${response.statusText}`);
        }
        return await response.json();
      } catch (error) {
        console.error('Fetch IP Data Error:', error);
        throw new Error('æ— æ³•è·å–IPä¿¡æ¯ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–APIé…ç½®');
      }
    };

    const showWelcome = ({ data, ip }) => {
      document.getElementById('loading-spinner').style.display = 'none';

      if (!data) return showErrorMessage();

      const { lng, lat, country, province, city, isp } = data;
      const dist = calculateDistance(lng, lat);
      const ipDisplay = formatIpDisplay(ip);
      const pos = formatLocation(country, province, city);

      document.getElementById('visitor-location').textContent = pos;
      document.getElementById('visitor-distance').textContent = dist;
      document.getElementById('visitor-ip').textContent = ipDisplay;
      document.getElementById('greeting-message').textContent = getTimeGreeting();
      document.getElementById('tip-message').textContent = getGreeting(country, province, city);
    };

    const formatLocation = (country, province, city) => {
      if (country && country === "ä¸­å›½") {
        return `${province} ${city}`;
      } else {
        return country || 'ç¥ç§˜åœ°åŒº';
      }
    };

    const calculateDistance = (lng, lat) => {
      const R = 6371;
      const rad = Math.PI / 180;
      const dLat = (lat - CONFIG.BLOG_LOCATION.lat) * rad;
      const dLon = (lng - CONFIG.BLOG_LOCATION.lng) * rad;
      const a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +
          Math.cos(CONFIG.BLOG_LOCATION.lat * rad) * Math.cos(lat * rad) *
          Math.sin(dLon / 2) * Math.sin(dLon / 2);
      return Math.round(R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a)));
    };

    const formatIpDisplay = (ip) => ip.includes(":") ? "å¤æ‚çš„IPv6åœ°å€" : ip;

    const showErrorMessage = (message = 'æŠ±æ­‰ï¼Œæ— æ³•è·å–ä¿¡æ¯') => {
      document.getElementById('loading-spinner').style.display = 'none';
      document.querySelector('.welcome-message').innerHTML = `
        <div class="error-message">
          <div class="error-icon">ğŸ˜•</div>
          <p id="error-message">${message}</p>
          <button id="retry-button">é‡è¯•</button>
        </div>
      `;
      document.getElementById('retry-button').addEventListener('click', () => {
        document.getElementById('loading-spinner').style.display = 'block';
        fetchIpInfo();
      });
    };


        const getTimeGreeting = () => {
      const hour = new Date().getHours();
      if (hour < 11) return "æ—©ä¸Šå¥½ğŸŒ¤ï¸ ï¼Œä¸€æ—¥ä¹‹è®¡åœ¨äºæ™¨";
      if (hour < 13) return "ä¸­åˆå¥½â˜€ï¸ ï¼Œè®°å¾—åˆä¼‘å–”~";
      if (hour < 17) return "ä¸‹åˆå¥½ğŸ• ï¼Œé¥®èŒ¶å…ˆå•¦ï¼";
      if (hour < 19) return "å³å°†ä¸‹ç­ğŸš¶â€â™‚ï¸ï¼Œè®°å¾—æŒ‰æ—¶åƒé¥­~";
      return "æ™šä¸Šå¥½ğŸŒ™ ï¼Œå¤œç”Ÿæ´»å—¨èµ·æ¥ï¼";
    };

    const greetings = {
      "ä¸­å›½": {
        "åŒ—äº¬": "åŒ—â€”â€”äº¬â€”â€”æ¬¢è¿ä½ ~~~",
        "å¤©æ´¥": "è®²æ®µç›¸å£°å§",
        "æ²³åŒ—": "å±±åŠ¿å·å·æˆå£å’ï¼Œå¤©ä¸‹é›„å…³é“é©¬é‡‘æˆˆç”±æ­¤å‘ï¼Œæ— é™æ±Ÿå±±",
        "å±±è¥¿": "å±•å¼€åå…·é•¿ä¸‰å°ºï¼Œå·²å å±±æ²³äº”ç™¾ä½™",
        "å†…è’™å¤": "å¤©è‹è‹ï¼Œé‡èŒ«èŒ«ï¼Œé£å¹è‰ä½è§ç‰›ç¾Š",
        "è¾½å®": "æˆ‘æƒ³åƒçƒ¤é¸¡æ¶ï¼",
        "å‰æ—": "çŠ¶å…ƒé˜å°±æ˜¯ä¸œåŒ—çƒ§çƒ¤ä¹‹ç‹",
        "é»‘é¾™æ±Ÿ": "å¾ˆå–œæ¬¢å“ˆå°”æ»¨å¤§å‰§é™¢",
        "ä¸Šæµ·": "ä¼—æ‰€å‘¨çŸ¥ï¼Œä¸­å›½åªæœ‰ä¸¤ä¸ªåŸå¸‚",
        "æ±Ÿè‹": {
          "å—äº¬": "è¿™æ˜¯æˆ‘æŒºæƒ³å»çš„åŸå¸‚å•¦",
          "è‹å·": "ä¸Šæœ‰å¤©å ‚ï¼Œä¸‹æœ‰è‹æ­",
          "å…¶ä»–": "æ•£è£…æ˜¯å¿…é¡»è¦æ•£è£…çš„"
        },
        "æµ™æ±Ÿ": {
          "æ­å·": "ä¸œé£æ¸ç»¿è¥¿æ¹–æŸ³ï¼Œé›å·²è¿˜äººæœªå—å½’",
          "å…¶ä»–": "æœ›æµ·æ¥¼æ˜ç…§æ›™éœ,æŠ¤æ±Ÿå ¤ç™½è¹‹æ™´æ²™"
        },
        "æ²³å—": {
          "éƒ‘å·": "è±«å·ä¹‹åŸŸï¼Œå¤©åœ°ä¹‹ä¸­",
          "ä¿¡é˜³": "å“ä¿¡é˜³æ¯›å°–ï¼Œæ‚Ÿäººé—´èŠ³å",
          "å—é˜³": "è‡£æœ¬å¸ƒè¡£ï¼Œèº¬è€•äºå—é˜³æ­¤å—é˜³éå½¼å—é˜³ï¼",
          "é©»é©¬åº—": "åµ–å²ˆå±±çš„èŠ±å¾ˆç¾å“¦ï¼",
          "å¼€å°": "åˆšæ­£ä¸é˜¿åŒ…é’å¤©",
          "æ´›é˜³": "æ´›é˜³ç‰¡ä¸¹ç”²å¤©ä¸‹",
          "å…¶ä»–": "å¯å¦å¸¦æˆ‘å“å°æ²³å—çƒ©é¢å•¦ï¼Ÿ"
        },
        "å®‰å¾½": "èšŒåŸ ä½äº†ï¼ŒèŠœæ¹–èµ·é£",
        "ç¦å»º": "äº•é‚‘ç™½äº‘é—´ï¼Œå²©åŸè¿œå¸¦å±±",
        "æ±Ÿè¥¿": "è½éœä¸å­¤é¹œé½é£ï¼Œç§‹æ°´å…±é•¿å¤©ä¸€è‰²",
        "å±±ä¸œ": "é¥æœ›é½å·ä¹ç‚¹çƒŸï¼Œä¸€æ³“æµ·æ°´æ¯ä¸­æ³»",
        "æ¹–åŒ—": {
          "é»„å†ˆ": "çº¢å®‰å°†å†›å¿ï¼è¾ˆå‡ºå°†æ‰ï¼",
          "å…¶ä»–": "æ¥ç¢—çƒ­å¹²é¢~"
        },
        "æ¹–å—": "74751ï¼Œé•¿æ²™æ–¯å¡”å…‹",
        "å¹¿ä¸œ": {
          "å¹¿å·": "çœ‹å°è›®è…°ï¼Œå–æ—©èŒ¶äº†å˜›~",
          "æ·±åœ³": "ä»Šå¤©ä½ é€›å•†åœºäº†å˜›~",
          "é˜³æ±Ÿ": "é˜³æ˜¥åˆæ°´ï¼åšä¸»å®¶ä¹¡~ æ¬¢è¿æ¥ç©~",
          "å…¶ä»–": "æ¥ä¸¤æ–¤ç¦å»ºäºº~"
        },
        "å¹¿è¥¿": "æ¡‚æ—å±±æ°´ç”²å¤©ä¸‹",
        "æµ·å—": "æœè§‚æ—¥å‡ºé€ç™½æµªï¼Œå¤•çœ‹äº‘èµ·æ”¶éœå…‰",
        "å››å·": "åº·åº·å·å¦¹å­",
        "è´µå·": "èŒ…å°ï¼Œå­¦ç”Ÿï¼Œå†å¡200",
        "äº‘å—": "ç‰é¾™é£èˆäº‘ç¼ ç»•ï¼Œä¸‡ä»å†°å·ç›´è€¸å¤©",
        "è¥¿è—": "èººåœ¨èŒ«èŒ«è‰åŸä¸Šï¼Œä»°æœ›è“å¤©",
        "é™•è¥¿": "æ¥ä»½è‡Šå­é¢åŠ é¦",
        "ç”˜è‚ƒ": "ç¾Œç¬›ä½•é¡»æ€¨æ¨æŸ³ï¼Œæ˜¥é£ä¸åº¦ç‰é—¨å…³",
        "é’æµ·": "ç‰›è‚‰å¹²å’Œè€é…¸å¥¶éƒ½å¥½å¥½åƒ",
        "å®å¤": "å¤§æ¼ å­¤çƒŸç›´ï¼Œé•¿æ²³è½æ—¥åœ†",
        "æ–°ç–†": "é©¼é“ƒå¤é“ä¸ç»¸è·¯ï¼Œèƒ¡é©¬çŠ¹é—»å”æ±‰é£",
        "å°æ¹¾": "æˆ‘åœ¨è¿™å¤´ï¼Œå¤§é™†åœ¨é‚£å¤´",
        "é¦™æ¸¯": "æ°¸å®šè´¼æœ‰æ®‹ç•™åœ°é¬¼åšï¼Œè¿å‡»å…‰éå²ç‰",
        "æ¾³é—¨": "æ€§æ„Ÿè·å®˜ï¼Œåœ¨çº¿å‘ç‰Œ",
        "å…¶ä»–": "å¸¦æˆ‘å»ä½ çš„åŸå¸‚é€›é€›å§ï¼"
      },
      "ç¾å›½": "Let us live in peace!",
      "æ—¥æœ¬": "ã‚ˆã‚ã—ãã€ä¸€ç·’ã«æ¡œã‚’è¦‹ã¾ã›ã‚“ã‹",
      "ä¿„ç½—æ–¯": "å¹²äº†è¿™ç“¶ä¼ç‰¹åŠ ï¼",
      "æ³•å›½": "C'est La Vie",
      "å¾·å›½": "Die Zeit verging im Fluge.",
      "æ¾³å¤§åˆ©äºš": "ä¸€èµ·å»å¤§å ¡ç¤å§ï¼",
      "åŠ æ‹¿å¤§": "æ‹¾èµ·ä¸€ç‰‡æ«å¶èµ äºˆä½ ",
      "å…¶ä»–": "å¸¦æˆ‘å»ä½ çš„å›½å®¶é€›é€›å§"
    };

    const getGreeting = (country, province, city) => {
      const countryGreeting = greetings[country] || greetings["å…¶ä»–"];
      if (typeof countryGreeting === 'string') return countryGreeting;

      const provinceGreeting = countryGreeting[province];
      if (provinceGreeting) {
        if (typeof provinceGreeting === 'string') return provinceGreeting;

        const cityGreeting = provinceGreeting[city];
        if (cityGreeting) return cityGreeting;

        return provinceGreeting["å…¶ä»–"] || countryGreeting["å…¶ä»–"];
      }

      return countryGreeting["å…¶ä»–"];
    };

    const fetchIpInfo = async () => {
      try {
        const data = await fetchIpData();
        showWelcome(data);
      } catch (error) {
        showErrorMessage(error.message);
      }
    };

    document.addEventListener('DOMContentLoaded', fetchIpInfo);
  </script>
</body>
</html>

